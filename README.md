# Edinet API を利用したユーティリティー
VisualStudio2017 C#を利用して作成した EDINET API を利用するユーティリティーです。
***

## [JsonDeserializer](https://github.com/yomibitosirazu/EdinetUtility/tree/master/JsonDeserializer/JsonDeserializer)
EdinetViewerのJSONクラス設計変更で、このクラスのデシリアライズが機能しているかを確認するための小物ツール（Windowsフォームアプリ）。
***

## [EdinetViewer](https://github.com/yomibitosirazu/EdinetUtility/tree/master/EdinetViewer)
EDINETの開示書類を表示するだけのC#Windowsフォームアプリケーション  
EDINET API を利用して日付ごとの開示書類のリスト一覧を取得  
一覧から選択したXBRLの開示書類をAPIでダウンロードしてエレメントを解析してテーブル表示

***
### 直近の変更    
#### 0.2.204.2  (2019-5-7)
**バグ修正：**
- タイマーによる当日の書類ダウンロードエラーの修正
    - dicMetadataのnullチェックを追加した
- 当日のメタデータ取得でタイプ1取得をスキップしていたのを修正

**変更**
- タイマーオンの時間内で起動した場合にはタイマー間隔の時間を待たずに、起動直後にメタデータを取得して当日分の書類のダウンロードもするように変更

#### 0.2.204.1  (2019-5-6)
**変更**
- メタデータ未確定の日付一覧をメッセージボックスで出力する右クリックメニュー追加
    - 当日分は除き、非取得と翌日以降にアクセスせずに確定していない日付一覧を出力
- 書類検索ダイアログを表示する右クリックメニュー追加
    - データベースに保存されたメタデータ（タイプ２）リストから検索
    - 日付にアクセスしていないものは検索できない
    - SQL文のwhere句をテキストボックスに入力して検索
    - いくつかの例文を表示可能　これをダブルクリックすると検索テキストボックスにコピーして検索実行できる
    - テーブル表示ボタンをクリックするとリストテーブルに出力される
- リストテーブルに表示されている書類一覧だけを書類の連続ダウンロード対象とする右クリックメニューを「バックグラウンドで実行」に追加
   - ダウンロードする書類は設定ダイアログで指定した書類　ただし、監視銘柄はすべてダウンロード
- リスト一覧の連続ダウンロード追加に伴い、連続ダウンロードロジックを一部変更
    - 連続ダウンロードの順番を日付＋番号の昇順と降順を設定ダイアログから事前に変更できるようにした。
    - デバッグが十分とは言えず、オブジェクトのインスタンスエラーが出ることがあるかもしれない
##### 書類連続ダウンロードのロジックについて
1. 未取得または確定していないメタデータ日付一覧取得
    1. メタデータテーブルから確定した日付と書類件数を取得
    2. 前日から５年前までループを回してi.リストにない日付一覧を取得
2. disclosuresテーブルから設定ダイアログで指定した未ダウンロード書類を抽出
3. 1.及び2.のリストを昇順または逆順で日付を処理
4. 対象の日付が1-1リストに存在して件数がある場合は増加することはないため直接タイプ２の書類一覧メタデータを読む（現時点での縦覧終了などを確認するため）
5. ただし、 processDateTimeが24時間未満の場合は4をスキップしてデータベースのデーターをもとに判断する
6. 未確定日の場合はタイプ１のメタデータを読み、0件はスキップ
7. 確定リストの件数が増えていなかった場合も縦覧終了チェックのためタイプ２も読みに行く
6. 対象日の書類一覧をループ処理
    1. 対象書類が縦覧終了の場合、ローカルファイルをチェックしてダウンロード済みの場合はスキップ
    2. 未ダウンロードであればダウンロード実行
*  リストテーブルの書類をダウンロードする場合は、上記の1.をスキップし2.をリストテーブルのデータに変更し、テーブルに存在する設定ファイルで指定された書類のみダウンロードする


#### SqliteCoreのアンインストールとインストールが必要
- Githubにプッシュする段階でSqliteをアンインストールしていましたが忘れることが多いです
- NugetパッケージマネージャでSqliteCoreがインストール済みであれば、一度アンインストールして再度「参照」でsqliteを検索して再度インストールしてください
***

### バージョンについて
変更点についてはEdinetViewerフォルダ内の[CHANGELOG.md](EdinetViewer/CHANGELOG.md)を参照してください。
#### v0.2.1-- マスターブランチ（現在のブランチ）
- APIの取得を非同期に変更
- 多少の並列処理を可能
- 開発途中で不安定
-#### v0.1.00 ブランチv0100 初期公開バージョン
- APIの取得をHttpClientの同期処理を利用

<img src="https://github.com/yomibitosirazu/EdinetUtility/blob/master/EdinetViewer/images/DisclosureViewer.png">

## 開発環境
Microsoft Visual Studio Community 2017   
Windows10 Pro 64bit  
Windows10 Home 32bit (Pararells Desktop 13 for Mac)
